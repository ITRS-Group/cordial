username: readonly
password: geneos
use-tls: true
allow-insecure: true
port: 7038

# configure the email server details in your user dv2html YAML file -
# which should have "0600" permissions - which is then merged with the
# YAML file in the working directory. Your user YAML file is normally
# ${HOME}/.config/geneos/dv2html.yaml

# email:
#   smtp: smtp.gmail.com
#   port: 465
#   username: user-email
#   password: ${enc:~/.config/geneos/keyfile.aes:+encs+XXX}
#   from: from-email
#   to: destination-email
#   subject: Default Subject

# The order of the columns cannot be guaranteed in the Gateway snapshot
# output, nor is the name of the first column (the 'rowName') given. Use
# this section to match (using shell globbing rules and not regular
# expressions) the name of the dataview to select the columns to output
# and in what order. The first value is always applied to th first
# column, which is special. Note that if an environment variable
# '__columns' (case insensitive name, comma separated values) is passed
# to the program that will override these settings.
#
# The dataview name is tested against all the keys in longest to
# shortest order and the first match wins.
#
# Apart from the first column name you can use further patterns to match
# multiple columns and any columns not listed are excluded from the
# output
column-order:
  # dvname*: [ list, of, columns ]
  toolkit: [ username, passwd, uid, gid, gcos, homedir, shell ]
  # '*': [ unknown ]

# similar to the above, these settings let you filter rows from being
# used. Each string is matched against the rowname (first column) and if
# the rowname does not match any of the patterns it will be dropped from
# the email. You cannot change the order of the rows.
row-filter:
  # '*': [ sys*, root ]

row-order:
  toolkit: uid

# similar to the above, these settings let you filter headlines from
# being included in the email. No ordering is possible.
headline-filter:
  # '*': samp*

# embed these images and give them the (short) name on the left these
# can then be referenced in the HTML as <img href="cid:logo.png"/> etc.
images:
  logo.png: ./cmd/icon_OurSolutions-geneos-image.png

text-template: |+
  This email has been generated by the ITRS Geneos system using the
  dv2html program. If you did not expect to received this email then
  please contact the sender.

html-template: |+
  <html>
  <head>
  <style>
    .CRITICAL {
      background-color: crimson;
      color: white;
    }

    .WARNING {
      background-color: gold;
      color: black;
    }

    .OK {
      background-color: limegreen;
      color: white;
    }

    .UNDEFINED {
      background-color: lightgrey;
      color: black;
    }

    table, th, td {
      table-layout: fixed;
      font-family: Lucida Console, monospace;
      border: 1px solid black;
      border-collapse: collapse;
      padding: 5px;
      text-align: left;
      vertical-align: top;
    }

    td {
      word-wrap: break-word;
    }

    .envname {
      width: 25%;
    }

    dt {
      font-weight: bold;
    }

    .dataview {
      /* border: 1px solid black; */
      padding: 5px;
    }

    .headlines {
      border: 1px solid white;
    }

    .rows {
      font-size: 0.8em;
    }

    .target {
      border: 3px solid blue;
    }
  </style>
  </head>
  <body>

  <a href="https://www.itrsgroup.com/products/geneos"><img src="cid:logo.png"/></a>

  <h1>ITRS Geneos DV2HTML Default Template</h1>

  <p>This content has been generated by the default template built into
  the dv2html program from the ITRS <a
  href="https://github.com/ITRS-Group/cordial">cordial</a> tool set. It is
  normally only see when testing. If you did not expect to receive this
  please contact the sender and let them know.</p>

  <h2>Dataviews</h2>

  <p>These Dataviews matched the input <b>_VARIABLEPATH</b>: <code>{{.Env._VARIABLEPATH}}</code></p>
  <p></p>

  {{range $index, $dataview := .Dataviews}}

  <table class="dataview">
    <tbody>
      <tr><th>Dataview</th><td>{{.Name}}</td></tr>
      <tr><th>XPath</th><td>{{.XPath}}</td></tr>
      <tr><th>Last Sample</th><td>{{.SampleTime}}</td></tr>
      <tr>
        <th>Headlines</th>
        <td>
          <table class="headlines">
            <tbody>
              {{range $headline, $values := .Headlines}}<tr>
                <th class="headlines">{{$headline}}</th>
                <td class="headlines {{.Severity}} {{if and (eq $.Env._HEADLINE $headline)}} target{{end}}">{{$values.Value}}</td>
              </tr>
              {{end}}
            </tbody>
          </table>
        </td>
      </tr>
      <tr>
        <th>Rows</th>
        <td>
          <table class="rows">
            <thead>
              {{range .Columns}}<th>{{.}}</th>{{end}}
            </thead>
            <tbody>
              {{range $row := $.Rows}}
              <tr>
                <th>{{$row}}</th>
                {{range $i, $column := $dataview.Columns}}
                    {{if ne $i 0}}
                      {{with (index $dataview.Table $row $column)}}
                        <td class="cells {{.Severity}}{{if and (eq $.Env._ROWNAME $row) (eq $.Env._COLUMN $column)}} target{{end}}">{{.Value}}</td>
                      {{end}}
                    {{end}}
                {{end}}
              </tr>
              {{end}}
            </tbody>
          </table>
          {{end}}
        </td>
      </tr>
    </tbody>
  </table>

  <h2>Environment Variables</h2>
  <table style="width: 100%;">
    <thead>
      <th class="envname">Name</th>
      <th>Value</th>
    </thead>
    <tbody>
      {{range $key, $value := .Env}}<tr>
        <th class="envname">{{$key}}</th>
        <td style="word-wrap: break-word;">{{$value}}</td>
      </tr>{{end}}
    </tbody>
  </table>

  </body>
  </html>